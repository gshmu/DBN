<!DOCTYPE data-dictionary [
        <!ELEMENT data-dictionary (statement-execution-processor)*>
        <!ELEMENT statement-execution-processor (statement)*>
        <!ATTLIST statement-execution-processor
                id CDATA #REQUIRED
                timeout CDATA #IMPLIED>
        <!ELEMENT statement (#PCDATA)>
        ]>
<data-dictionary>
    <statement-execution-processor id="setup-credential" timeout="20">
        <statement>
            DECLARE
            v_credential_count NUMBER;
            BEGIN
            SELECT COUNT(*)
            INTO v_credential_count
            FROM ALL_CREDENTIALS
            WHERE CREDENTIAL_NAME = '{0}';

            IF v_credential_count = 0 THEN
            DBMS_CLOUD.CREATE_CREDENTIAL(
            '{1}'
            );
            END IF;
            END;
        </statement>
    </statement-execution-processor>
    <statement-execution-processor id="create-profile" timeout="20">
        <statement>
            DECLARE
            v_profile_count NUMBER;
            BEGIN
            SELECT COUNT(*)
            INTO v_profile_count
            FROM DBA_CLOUD_AI_PROFILES
            WHERE PROFILE_NAME = '{0}';

            IF v_profile_count = 0 THEN
            DBMS_CLOUD_AI.CREATE_PROFILE(
            '{1}'
            );
            END IF;
            END;
        </statement>
    </statement-execution-processor>
    <statement-execution-processor id="pick-profile" timeout="20">
        <statement>
            BEGIN
            DBMS_CLOUD_AI.SET_PROFILE(
            profile_name => '{0}'
            );
            END;
        </statement>
    </statement-execution-processor>
    <statement-execution-processor id="list-credentials" timeout="10">
        <statement>
            declare
            credential_names VARCHAR2(4000);
            BEGIN
            SELECT LISTAGG(CREDENTIAL_NAME, ' ') WITHIN GROUP (ORDER BY CREDENTIAL_NAME)
            INTO credential_names
            FROM ALL_CREDENTIALS;
            ? := credential_names;
            END;
        </statement>
    </statement-execution-processor>
    <statement-execution-processor id="list-profiles" timeout="10">
        <statement>
            declare
            profile_names VARCHAR2(4000);
            begin
            SELECT LISTAGG(PROFILE_NAME, ' ') WITHIN GROUP ( ORDER BY PROFILE_NAME )
            INTO profile_names
            FROM USER_CLOUD_AI_PROFILES;
            ? := profile_names;
            end;
        </statement>
    </statement-execution-processor>

    <statement-execution-processor id="list-credentials-detailed" timeout="20">
        <statement>
            SELECT * FROM ALL_CREDENTIALS
        </statement>
    </statement-execution-processor>
    <statement-execution-processor id="list-profiles-detailed" timeout="20">
        <statement>
            SELECT * FROM USER_CLOUD_AI_PROFILE_ATTRIBUTES
        </statement>
    </statement-execution-processor>
    <statement-execution-processor id="ai-query">
        <statement>
            declare
            query_output VARCHAR2(4000);
            begin
            SELECT DBMS_CLOUD_AI.GENERATE(
                prompt => '{2}',
                profile_name => '{0}',
                action => '{1}',
                attributes => '{3}')
            INTO query_output
            FROM dual;
            ? := query_output;
            end;
        </statement>
    </statement-execution-processor>
    <statement-execution-processor id="list-tables" timeout="20">
        <statement>
            SELECT OWNER, TABLE_NAME
            FROM all_tables
        </statement>
    </statement-execution-processor>
    <statement-execution-processor id="list-views" timeout="20">
        <statement>
            declare
            views VARCHAR2(4000);
            begin
            SELECT LISTAGG(VIEW_NAME, ' ') WITHIN GROUP ( ORDER BY VIEW_NAME )
            INTO views
            FROM all_views;
            ? := views;
            end;
        </statement>
    </statement-execution-processor>
    <statement-execution-processor id="list-schemas" timeout="20">
        <statement>
            SELECT DISTINCT OWNER
            FROM ALL_TABLES
            UNION
            SELECT DISTINCT OWNER
            FROM ALL_VIEWS
        </statement>
    </statement-execution-processor>
    <statement-execution-processor id="drop-profile" timeout="20">
        <statement>
            BEGIN
            DBMS_CLOUD_AI.DROP_PROFILE(profile_name => '{0}');
            END;
        </statement>
    </statement-execution-processor>
    <statement-execution-processor id="drop-credential" timeout="20">
        <statement>
            BEGIN
            DBMS_CLOUD.DROP_CREDENTIAL(credential_name => '{0}');
            END;
        </statement>
    </statement-execution-processor>
    <statement-execution-processor id="update-profile" timeout="20">
        <statement>
            BEGIN
            DBMS_CLOUD_AI.SET_ATTRIBUTE(
            profile_name    => '{0}',
            attribute_name  => '{1}',
            attribute_value => '{2}'
            );
            END;
        </statement>
    </statement-execution-processor>
    <statement-execution-processor id="update-credential" timeout="20">
        <statement>
            BEGIN
            DBMS_CLOUD.UPDATE_CREDENTIAL(
            credential_name => '{0}',
            attribute => '{1}}',
            value => '{2}}');
            END;
        </statement>
    </statement-execution-processor>

</data-dictionary>
